{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Cashier POS (Left Cart)</title>
    <style>
        /* === –°–¢–ò–õ–ò POS (–ü–ï–†–ï–í–ï–†–ù–£–¢–ê–Ø –†–ê–°–ö–õ–ê–î–ö–ê) === */
        
        body { margin: 0; padding: 0; height: 100vh; overflow: hidden; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background-color: #F3F4F6; }
        
        /* –ì–õ–ê–í–ù–´–ô –ö–û–ù–¢–ï–ô–ù–ï–† */
        .pos-container {
            display: flex;
            height: 100vh;
            width: 100%;
        }

        /* === 1. –õ–ï–í–ê–Ø –ö–û–õ–û–ù–ö–ê (–¢–ï–ü–ï–†–¨ –≠–¢–û –ö–û–†–ó–ò–ù–ê) === */
        .panel-cart {
            flex: 1;             /* –£–∑–∫–∞—è –∫–æ–ª–æ–Ω–∫–∞ (30-35%) */
            min-width: 380px;    /* –ß—Ç–æ–±—ã —á–µ–∫ –Ω–µ —Å–ø–ª—é—â–∏–ª–æ */
            background: #ffffff;
            border-right: 1px solid #E5E7EB; /* –õ–∏–Ω–∏—è —Å–ø—Ä–∞–≤–∞ */
            display: flex;
            flex-direction: column;
            padding: 20px;
            box-shadow: 4px 0 15px rgba(0,0,0,0.03);
            z-index: 10;
        }

        /* === 2. –ü–†–ê–í–ê–Ø –ö–û–õ–û–ù–ö–ê (–¢–ï–ü–ï–†–¨ –≠–¢–û –ú–ï–ù–Æ) === */
        .panel-menu {
            flex: 2.5;           /* –®–∏—Ä–æ–∫–∞—è –∫–æ–ª–æ–Ω–∫–∞ (65-70%) */
            background: #F9FAFB;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        /* --- –≠–õ–ï–ú–ï–ù–¢–´ –ö–û–†–ó–ò–ù–´ (–°–õ–ï–í–ê) --- */
        
        /* –ö–Ω–æ–ø–∫–∞ –ù–∞–∑–∞–¥ */
        .btn-back {
            background-color: #F3F4F6; color: #1F2937;
            padding: 10px 16px; border-radius: 20px;
            text-decoration: none; font-weight: 600; font-size: 14px;
            display: inline-flex; align-items: center; gap: 8px;
            width: fit-content; margin-bottom: 20px; transition: 0.2s;
        }
        .btn-back:hover { background-color: #E5E7EB; }

        /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ —á–µ–∫–∞ */
        .cart-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .t-current { font-size: 20px; font-weight: 800; color: #111; }
        .order-badge { background: #FCD34D; padding: 4px 10px; border-radius: 8px; font-weight: bold; font-size: 14px; }

        /* –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ –≤ —á–µ–∫–µ */
        .cart-list { 
            flex-grow: 1; 
            overflow-y: auto; 
            background: #F9FAFB; 
            border-radius: 12px; 
            border: 1px solid #E5E7EB; 
            padding: 10px; 
            margin-bottom: 15px;
        }
        .cart-item { 
            display: flex; justify-content: space-between; 
            padding: 12px; border-bottom: 1px solid #E5E7EB; 
            font-size: 15px; font-weight: 500; background: #fff;
            margin-bottom: 8px; border-radius: 8px;
        }
        .cart-item:last-child { margin-bottom: 0; }

        /* –ò—Ç–æ–≥–æ –∏ –û–ø–ª–∞—Ç–∞ */
        .total-section { margin-top: auto; border-top: 1px solid #eee; padding-top: 15px; }
        .total-row { display: flex; justify-content: space-between; font-size: 22px; font-weight: 800; margin-bottom: 15px; color: #111; }
        
        .pay-button {
            width: 100%; background: #1F2937; color: white;
            padding: 16px; border: none; border-radius: 12px;
            font-size: 18px; font-weight: 700; cursor: pointer; transition: 0.2s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .pay-button:hover { background: #000; transform: translateY(-2px); }
        .pay-button:active { transform: scale(0.98); }


        /* --- –≠–õ–ï–ú–ï–ù–¢–´ –ú–ï–ù–Æ (–°–ü–†–ê–í–ê) --- */

        /* –ü–æ–∏—Å–∫ (–¢–ï–ü–ï–†–¨ –°–í–ï–†–•–£) */
        .search-container { margin-bottom: 20px; }
        .search-input { 
            width: 100%; padding: 14px 20px; 
            border: 1px solid #E5E7EB; border-radius: 14px; 
            box-sizing: border-box; outline: none; font-size: 15px;
            background: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.02);
        }
        .search-input:focus { border-color: #FCD34D; box-shadow: 0 0 0 3px rgba(252, 211, 77, 0.2); }

        /* –¢–∞–±—ã */
        .category-tabs { display: flex; gap: 12px; margin-bottom: 20px; overflow-x: auto; padding-bottom: 5px; }
        .tab-btn {
            padding: 12px 24px; border: 1px solid #E5E7EB; background: #fff;
            border-radius: 12px; font-weight: 600; color: #374151; cursor: pointer; transition: 0.2s;
            white-space: nowrap;
        }
        .tab-btn.active { background: #1F2937; color: #fff; border-color: #1F2937; }

        /* –°–µ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ */
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            overflow-y: auto; 
            padding-bottom: 20px; padding-right: 5px;
            align-content: start;
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∞ */
        .menu-item {
            background: #fff; border: 1px solid #E5E7EB; border-radius: 16px;
            padding: 15px; height: 110px; cursor: pointer;
            display: flex; flex-direction: column; justify-content: space-between;
            box-shadow: 0 2px 4px rgba(0,0,0,0.02); transition: all 0.1s;
            position: relative; overflow: hidden;
        }
        .menu-item:active { transform: scale(0.96); border-color: #FCD34D; }
        
        .item-name { font-weight: 700; font-size: 15px; color: #1F2937; z-index: 2; }
        .item-price { font-weight: 800; color: #059669; font-size: 16px; z-index: 2; }
        
        .bg-icon {
            position: absolute; right: -5px; bottom: -5px; width: 65px; height: 65px;
            color: #F3F4F6; transform: rotate(-10deg); z-index: 1; pointer-events: none;
        }

    </style>
</head>
<body>

    <div class="pos-container">
        
        <div class="panel-cart">
            
            <a href="{% url 'home' %}" class="btn-back">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
                <span class="t-back">–ù–∞–∑–∞–¥</span>
            </a>

            <div class="cart-header">
                <span class="t-current">–¢–µ–∫—É—â–∏–π –∑–∞–∫–∞–∑</span>
                <span class="order-badge">#31</span>
            </div>

            <div class="cart-list" id="cart-items">
                </div>

            <div class="total-section">
                <div class="total-row">
                    <span class="t-total">–ò—Ç–æ–≥–æ</span>
                    <span id="total-price">0 ‚Ç∏</span>
                </div>
                <button class="pay-button" onclick="submitOrder()">
                    <span class="t-pay">–û–ø–ª–∞—Ç–∏—Ç—å</span>
                </button>
            </div>
        </div>

        <div class="panel-menu">
            
            <div class="search-container">
                <input type="text" placeholder="–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–∞..." class="search-input t-search-ph">
            </div>

            <div class="category-tabs">
                <button class="tab-btn active" onclick="filterMenu('coffee')">‚òï <span class="t-coffee">–ö–æ—Ñ–µ</span></button>
                <button class="tab-btn" onclick="filterMenu('snacks')">ü•ê <span class="t-food">–ï–¥–∞</span></button>
                <button class="tab-btn" onclick="filterMenu('other')">ü•§ <span class="t-other">–î—Ä—É–≥–æ–µ</span></button>
            </div>

            <div class="menu-grid" id="menu-grid">
                <div class="menu-item" onclick="addToCart('–≠—Å–ø—Ä–µ—Å—Å–æ', 800)" data-category="coffee">
                    <div class="item-name">–≠—Å–ø—Ä–µ—Å—Å–æ</div><div class="item-price">800 ‚Ç∏</div>
                    <svg class="bg-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M18.5 3H6c-1.1 0-2 .9-2 2v5.71c0 3.83 2.95 7.18 6.78 7.29 3.96.12 7.22-3.06 7.22-7v-1h.5c1.93 0 3.5-1.57 3.5-3.5S20.43 3 18.5 3z"/></svg>
                </div>
                <div class="menu-item" onclick="addToCart('–ê–º–µ—Ä–∏–∫–∞–Ω–æ', 900)" data-category="coffee">
                    <div class="item-name">–ê–º–µ—Ä–∏–∫–∞–Ω–æ</div><div class="item-price">900 ‚Ç∏</div>
                    <svg class="bg-icon" viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="12" r="9"/></svg>
                </div>
                <div class="menu-item" onclick="addToCart('–õ–∞—Ç—Ç–µ', 1400)" data-category="coffee">
                    <div class="item-name">–õ–∞—Ç—Ç–µ</div><div class="item-price">1400 ‚Ç∏</div>
                    <svg class="bg-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M18 8h1a4 4 0 0 1 0 8h-1"></path><path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"></path></svg>
                </div>
                <div class="menu-item" onclick="addToCart('–ö–∞–ø—É—á–∏–Ω–æ', 1200)" data-category="coffee">
                    <div class="item-name">–ö–∞–ø—É—á–∏–Ω–æ</div><div class="item-price">1200 ‚Ç∏</div>
                    <svg class="bg-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M17 19h-1.4c-.66.8-1.63 1.34-2.71 1.48L13 22h-2l.11-1.52c-1.08-.14-2.05-.68-2.71-1.48H7c-1.1 0-2-.9-2-2V8c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2v10c0 1.1-.9 2-2 2z"/></svg>
                </div>
                
                <div class="menu-item" onclick="addToCart('–ö—Ä—É–∞—Å—Å–∞–Ω', 850)" data-category="snacks">
                    <div class="item-name">–ö—Ä—É–∞—Å—Å–∞–Ω</div><div class="item-price">850 ‚Ç∏</div>
                    <svg class="bg-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M22 10v9c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2v-9h20z"/></svg>
                </div>

                <div class="menu-item" onclick="addToCart('–ß–∞–π', 600)" data-category="other">
                    <div class="item-name">–ß–∞–π</div><div class="item-price">600 ‚Ç∏</div>
                    <svg class="bg-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M20 3H4v10c0 2.21 1.79 4 4 4h6c2.21 0 4-1.79 4-4v-3h2c1.11 0 2-.9 2-2V5c0-1.11-.89-2-2-2z"/></svg>
                </div>
            </div>

        </div>

    </div>

    <script>
        const dict = {
            'ru': { 'back': '–ù–∞–∑–∞–¥', 'coffee': '–ö–æ—Ñ–µ', 'food': '–ï–¥–∞', 'other': '–î—Ä—É–≥–æ–µ', 'current': '–¢–µ–∫—É—â–∏–π –∑–∞–∫–∞–∑', 'total': '–ò—Ç–æ–≥–æ', 'pay': '–û–ø–ª–∞—Ç–∏—Ç—å', 'sent': '–ó–∞–∫–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –∫—É—Ö–Ω—é! üë®‚Äçüç≥' },
            'en': { 'back': 'Back', 'coffee': 'Coffee', 'food': 'Food', 'other': 'Other', 'current': 'Current Order', 'total': 'Total', 'pay': 'Charge', 'sent': 'Order sent to kitchen! üë®‚Äçüç≥' }
        };

        function applyLang() {
            const lang = localStorage.getItem('pos_lang') || 'ru';
            document.querySelectorAll('[class^="t-"]').forEach(el => {
                const key = el.className.split(' ')[0].replace('t-', '');
                if (dict[lang][key]) el.innerText = dict[lang][key];
            });
            const ph = lang === 'en' ? "Search products..." : "–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–∞...";
            document.querySelector('.search-input').placeholder = ph;
        }
        applyLang();

        let cart = [];
        function addToCart(name, price) {
            cart.push({name, price});
            renderCart();
        }
        function renderCart() {
            const container = document.getElementById('cart-items');
            container.innerHTML = '';
            let total = 0;
            
            if (cart.length === 0) {
                container.innerHTML = '<div style="color:#aaa; text-align:center; padding-top:20px;">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>';
            }

            cart.forEach(item => {
                total += item.price;
                container.innerHTML += `
                    <div class="cart-item">
                        <span>${item.name}</span>
                        <span style="font-weight:700;">${item.price} ‚Ç∏</span>
                    </div>`;
            });
            document.getElementById('total-price').innerText = total + " ‚Ç∏";
        }
        function submitOrder() {
            if(cart.length === 0) return alert("–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞!");
            fetch('/api/order/create/', {
                method: 'POST', headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ items: cart })
            })
            .then(res => res.json())
            .then(data => {
                if(data.success) {
                    const lang = localStorage.getItem('pos_lang') || 'ru';
                    alert(dict[lang]['sent']); 
                    cart = []; renderCart();
                } else {
                    alert("–û—à–∏–±–∫–∞: " + data.error);
                }
            });
        }
        function filterMenu(category) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.currentTarget.classList.add('active');
            document.querySelectorAll('.menu-item').forEach(item => {
                if(item.dataset.category === category) item.style.display = 'flex';
                else item.style.display = 'none';
            });
        }
    </script>
</body>
</html>